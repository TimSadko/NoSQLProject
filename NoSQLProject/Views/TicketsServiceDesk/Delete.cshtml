@model NoSQLProject.Models.Ticket

@{
    ViewData["Title"] = "Delete Ticket";
}

<partial name="_ErrorMessage" />

<div class="fade-in">
    <div class="delete-card">
        <h2 class="delete-title">Delete Ticket</h2>

        <div class="alert alert-danger text-center fw-semibold mb-4">
            Are you sure you want to permanently delete this ticket?
        </div>

        <!-- Ticket Details -->
        <div class="ticket-details">
            <div class="detail-row">
                <span class="detail-label">Creator:</span>
                <span class="detail-value">@Model.Creator.FullName</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Created At:</span>
                <span class="detail-value">@Model.CreatedAt.ToString("dd.MM.yyyy HH:mm:ss")</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Last Update:</span>
                <span class="detail-value">@Model.UpdatedAt.ToString("dd.MM.yyyy HH:mm:ss")</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Title:</span>
                <span class="detail-value fw-bold">@Model?.Title</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Description:</span>
                <span class="detail-value">@Model?.Description</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Priority:</span>
                <span class="detail-value">
                    @{
                        var priorityClass = Model.Priority switch
                        {
                            Ticket_Priority.Critical => "priority-critical",
                            Ticket_Priority.High => "priority-high",
                            Ticket_Priority.Medium => "priority-medium",
                            Ticket_Priority.Low => "priority-low",
                            Ticket_Priority.Undefined => "priority-undefined",
                            _ => "priority-undefined"
                        };
                   
                    }
                    <span class="priority-badge @priorityClass">
                        @Model.Priority
                    </span>
                </span>
            </div>
        </div>

        <!-- Logs Section -->
        <div class="logs-section">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="logs-title">Activity Logs</h3>
                <a href="/TicketsServiceDesk/AddLog/@Model.Id" class="btn btn-add-log">Add Log</a>
            </div>

            @if (Model.Logs.Count == 0)
            {
                <div class="alert alert-info text-center">
                    No logs yet. Add one to track changes!
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table logs-table">
                        <thead>
                            <tr>
                                <th>Created By</th>
                                <th>Time</th>
                                <th>Status</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (Log log in Model.Logs)
                            {
                                <tr>
                                    <td class="fw-semibold">@(log.Creator == null ? "???" : log.Creator.FullName)</td>
                                    <td class="date-cell">@log.CreatedAt.ToString("MMM dd, HH:mm")</td>
                                    <td>
                                        <span class="status-badge status-@log.NewStatus.ToString().ToLower()">
                                            @log.NewStatus
                                        </span>
                                    </td>
                                    <td class="description-cell">
                                        @if (string.IsNullOrEmpty(log.Description))
                                        {
                                            <span class="text-muted">-</span>
                                        }
                                        else if (log.Description.Length > 100)
                                        {
                                            @(log.Description.Substring(0, 100))
                                            
                                                                }
                                        else
                                        {
                                            @log.Description
                                        }
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <a href="/TicketsServiceDesk/EditLog/@(Model.Id)/@(log.Id)" class="btn-action btn-edit-sm">Edit</a>
                                            <a href="/TicketsServiceDesk/DeleteLog/@(Model.Id)/@(log.Id)" class="btn-action btn-delete-sm">Delete</a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>

        <!-- Delete Form -->
        <form action="/TicketsServiceDesk/Delete" method="post">
            <input type="hidden" asp-for="@Model.Id" value="@Model.Id" />

            <div class="d-flex justify-content-between align-items-center mt-4">
                <a href="/TicketsServiceDesk/Index" class="btn btn-cancel px-4 py-2">Cancel</a>
                <button type="submit" class="btn btn-delete px-4 py-2">Delete Ticket</button>
            </div>
        </form>
    </div>
</div>
