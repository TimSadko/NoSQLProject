@model NoSQLProject.Models.Ticket

@{
    ViewData["Title"] = "Edit Ticket";

    //Console.WriteLine(Model.CreatedAt.ToString("dd.MM.yyyy HH:mm:ss")); // Debug
}

<partial name="_ErrorMessage" />

<h1>Ticket:</h1>

<div class="form-group py-2 text-start">
    <label>Creator:</label>
    <input type="text" class="form-control input-background" readonly value="@ViewData["ticket_creator"]" />
</div>

<div class="form-group py-2 text-start">
    <label>Created At:</label>
    <input type="text" class="form-control input-background" readonly value="@Model.CreatedAt.ToString("dd.MM.yyyy HH:mm:ss")" />
</div>

<div class="form-group py-2 text-start">
    <label>Last Update:</label>
    <input type="text" class="form-control input-background" readonly value="@Model.UpdatedAt.ToString("dd.MM.yyyy HH:mm:ss")" />
</div>

<form action="/TicketsServiceDesk/Edit" method="post">
    <input type="hidden" asp-for="Id" value="@Model.Id" />

    <div class="form-group py-2 text-start">
        <label for="Title">Title:</label>
        <input type="text" class="form-control input-background" asp-for="Title" required value="@Model?.Title" />
    </div>

    <div class="form-group py-2 text-start">
        <label for="Description">Description:</label>
        <input type="text" class="form-control input-background" asp-for="Description" required value="@Model?.Description" />
    </div>

    <div class="form-group py-2 text-start">
        <label for="Description">Status:</label>
        <select class="form-control input-background" asp-for="Status" asp-items="@Html.GetEnumSelectList<Ticket_Status>()"></select>
    </div>    

    <button type="submit" class="primary-button">Edit</button>
</form>


<div class="form-group py-2 text-start">
    <label>Logs:</label>
    @{
        if (Model?.Logs.Count == 0)
        {
            <div>No logs yet</div>
        }
        else
        {
            <table class="table">
                <thead>
                    <tr>
                        <th>Created By</th>
                        <th>Creation Time</th>
                        <th>New Status</th>
                        <th>Description</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        foreach(Log log in Model.Logs)
                        {                                                      
                            <tr>
                                <th>@(log.Creator == null ? "???" : log.Creator.FullName)</th>
                                <th>@log.CreatedAt</th>
                                <th>@log.NewStatus</th>

                                @if (string.IsNullOrEmpty(log.Description)) // If deescription is empty
                                {
                                    <th>-</th>
                                }
                                else
                                {
                                    if (log.Description.Length > 100) // If it is too long, cut it
                                    {
                                        <th>@(log.Description.Substring(0, 100))...</th>
                                    }
                                    else // If it is short enough, put it as it is
                                    {
                                        <th>@(log.Description.Substring(0, log.Description.Length))</th>
                                    }
                                }

                                <th>
                                    <a href="/TicketsServiceDesk/EditLog/@(Model.Id)/@(log.Id)">View</a>
                                    <a class="text-danger" href="/TicketsServiceDesk/DeleteLog/@(Model.Id)/@(log.Id)">Delete</a>
                                </th>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        }
    }  
    <a href="/TicketsServiceDesk/AddLog/@Model.Id">Add New Log</a>
</div>

<a href="/TicketsServiceDesk/Index">Back to Ticket List</a>


