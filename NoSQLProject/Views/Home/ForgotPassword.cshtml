@{
    ViewData["Title"] = "Forgot Password";
    var loginUrl = Url.Action("Login", "Home");
}

<partial name="_ErrorMessage" />

<h2>Reset your password</h2>

<form id="forgotPasswordForm" asp-action="ForgotPassword" asp-controller="Home" method="post" class="p-3 border rounded" style="max-width:420px">
    @Html.AntiForgeryToken()

    <div class="mb-3">
        <label for="Email" class="form-label">Email</label>
        <input id="Email" name="Email" class="form-control" required />
    </div>

    <div class="mb-3">
        <label for="NewPassword" class="form-label">New password</label>
        <input id="NewPassword" name="NewPassword" type="password" class="form-control" autocomplete="new-password" required />
    </div>

    <div class="mb-3">
        <label for="ConfirmPassword" class="form-label">Confirm new password</label>
        <input id="ConfirmPassword" name="ConfirmPassword" type="password" class="form-control" autocomplete="new-password" required />
    </div>

    <button type="submit" class="btn btn-primary">Reset Password</button>
    <button type="button" class="btn btn-secondary" onclick="location.href='@loginUrl'">Back to login</button>
</form>

<!-- Accessible live region for screen readers (kept hidden visually) -->
<div id="passwordMismatchAlert" role="alert" aria-live="assertive" style="position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden;"></div>

@section Scripts {
    <script>
        (function () {
            // Keep client-side check in the view to avoid touching server logic (SRP: UI validation only).
            var form = document.getElementById('forgotPasswordForm');
            if (!form) return;

            form.addEventListener('submit', function (e) {
                var newPwd = (document.getElementById('NewPassword') || {}).value || '';
                var confirmPwd = (document.getElementById('ConfirmPassword') || {}).value || '';

                // Only show error if both fields exist and values don't match
                if (newPwd !== confirmPwd) {
                    e.preventDefault();
                    // visible popup for users
                    alert("The passwords entered don't match");

                    // accessibility: announce to screen readers
                    var live = document.getElementById('passwordMismatchAlert');
                    if (live) {
                        live.textContent = "The passwords entered don't match";
                    }

                    // focus the confirm field so user can correct quickly
                    var confirmEl = document.getElementById('ConfirmPassword');
                    if (confirmEl) {
                        confirmEl.focus();
                        confirmEl.select();
                    }
                }
            }, false);
        })();
    </script>
}